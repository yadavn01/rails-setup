<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Gem::Ext::CargoBuilder - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link"><a href="Builder.html">Gem::Ext::Builder</a>
</div>

    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-build">#build</a>
    <li ><a href="#method-i-build_crate">#build_crate</a>
    <li ><a href="#method-i-build_env">#build_env</a>
    <li ><a href="#method-i-cargo_command">#cargo_command</a>
    <li ><a href="#method-i-cargo_crate_name">#cargo_crate_name</a>
    <li ><a href="#method-i-cargo_dylib_path">#cargo_dylib_path</a>
    <li ><a href="#method-i-cargo_rustc_args">#cargo_rustc_args</a>
    <li ><a href="#method-i-darwin_target-3F">#darwin_target?</a>
    <li ><a href="#method-i-debug_flags">#debug_flags</a>
    <li ><a href="#method-i-final_extension_path">#final_extension_path</a>
    <li ><a href="#method-i-finalize_directory">#finalize_directory</a>
    <li ><a href="#method-i-get_relative_path">#get_relative_path</a>
    <li ><a href="#method-i-ldflag_to_link_modifier">#ldflag_to_link_modifier</a>
    <li ><a href="#method-i-libruby_args">#libruby_args</a>
    <li ><a href="#method-i-linker_args">#linker_args</a>
    <li ><a href="#method-i-makefile_config">#makefile_config</a>
    <li ><a href="#method-i-maybe_resolve_ldflag_variable">#maybe_resolve_ldflag_variable</a>
    <li ><a href="#method-i-mingw_target-3F">#mingw_target?</a>
    <li ><a href="#method-i-mkmf_libpath">#mkmf_libpath</a>
    <li ><a href="#method-i-msvc_target-3F">#msvc_target?</a>
    <li ><a href="#method-i-platform_specific_rustc_args">#platform_specific_rustc_args</a>
    <li ><a href="#method-i-profile_target_directory">#profile_target_directory</a>
    <li ><a href="#method-i-rb_config_env">#rb_config_env</a>
    <li ><a href="#method-i-rename_cdylib_for_ruby_compatibility">#rename_cdylib_for_ruby_compatibility</a>
    <li ><a href="#method-i-ruby_static-3F">#ruby_static?</a>
    <li ><a href="#method-i-rustc_dynamic_linker_flags">#rustc_dynamic_linker_flags</a>
    <li ><a href="#method-i-rustc_lib_flags">#rustc_lib_flags</a>
    <li ><a href="#method-i-so_ext">#so_ext</a>
    <li ><a href="#method-i-split_flags">#split_flags</a>
    <li ><a href="#method-i-validate_cargo_build-21">#validate_cargo_build!</a>
    <li ><a href="#method-i-win_target-3F">#win_target?</a>
    <li ><a href="#method-i-write_deffile">#write_deffile</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Gem::Ext::CargoBuilder">
  <h1 id="class-Gem::Ext::CargoBuilder" class="class">
    class Gem::Ext::CargoBuilder
  </h1>

  <section class="description">
    
<p>This class is used by rubygems to build Rust extensions. It is a thin-wrapper over the â€˜cargo rustc` command which takes care of building Rust code in a way that Ruby can use.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-profile" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">profile</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-runner" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">runner</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-spec" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">spec</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(spec)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 9</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">require_relative</span> <span class="ruby-string">&quot;../command&quot;</span>
  <span class="ruby-identifier">require_relative</span> <span class="ruby-string">&quot;cargo_builder/link_flag_converter&quot;</span>

  <span class="ruby-ivar">@spec</span> = <span class="ruby-identifier">spec</span>
  <span class="ruby-ivar">@runner</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:run</span>)
  <span class="ruby-ivar">@profile</span> = <span class="ruby-value">:release</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-build" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">build</span><span
            class="method-args">(_extension, dest_path, results, args = [], lib_dir = nil, cargo_dir = Dir.pwd)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="build-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 18</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build</span>(<span class="ruby-identifier">_extension</span>, <span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">results</span>, <span class="ruby-identifier">args</span> = [], <span class="ruby-identifier">lib_dir</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cargo_dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;fileutils&quot;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;shellwords&quot;</span>

  <span class="ruby-identifier">build_crate</span>(<span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">results</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">cargo_dir</span>)
  <span class="ruby-identifier">validate_cargo_build!</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-identifier">rename_cdylib_for_ruby_compatibility</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-identifier">finalize_directory</span>(<span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">lib_dir</span>, <span class="ruby-identifier">cargo_dir</span>)
  <span class="ruby-identifier">results</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-build_crate" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">build_crate</span><span
            class="method-args">(dest_path, results, args, cargo_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="build_crate-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_crate</span>(<span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">results</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">cargo_dir</span>)
  <span class="ruby-identifier">env</span> = <span class="ruby-identifier">build_env</span>
  <span class="ruby-identifier">cmd</span> = <span class="ruby-identifier">cargo_command</span>(<span class="ruby-identifier">cargo_dir</span>, <span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">runner</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">results</span>, <span class="ruby-string">&quot;cargo&quot;</span>, <span class="ruby-identifier">cargo_dir</span>, <span class="ruby-identifier">env</span>

  <span class="ruby-identifier">results</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-build_env" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">build_env</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="build_env-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">build_env</span>
  <span class="ruby-identifier">build_env</span> = <span class="ruby-identifier">rb_config_env</span>
  <span class="ruby-identifier">build_env</span>[<span class="ruby-string">&quot;RUBY_STATIC&quot;</span>] = <span class="ruby-string">&quot;true&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby_static?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&quot;RUBY_STATIC&quot;</span>)
  <span class="ruby-identifier">build_env</span>[<span class="ruby-string">&quot;RUSTFLAGS&quot;</span>] = <span class="ruby-node">&quot;#{ENV[&quot;RUSTFLAGS&quot;]} --cfg=rb_sys_gem&quot;</span>.<span class="ruby-identifier">strip</span>
  <span class="ruby-identifier">build_env</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-cargo_command" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">cargo_command</span><span
            class="method-args">(cargo_dir, dest_path, args = [])</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="cargo_command-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cargo_command</span>(<span class="ruby-identifier">cargo_dir</span>, <span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">args</span> = [])
  <span class="ruby-identifier">manifest</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">cargo_dir</span>, <span class="ruby-string">&quot;Cargo.toml&quot;</span>)
  <span class="ruby-identifier">cargo</span> = <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;CARGO&quot;</span>, <span class="ruby-string">&quot;cargo&quot;</span>)

  <span class="ruby-identifier">cmd</span> = []
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-identifier">cargo</span>, <span class="ruby-string">&quot;rustc&quot;</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--target&quot;</span>, <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;CARGO_BUILD_TARGET&quot;</span>]] <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;CARGO_BUILD_TARGET&quot;</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--target-dir&quot;</span>, <span class="ruby-identifier">dest_path</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--manifest-path&quot;</span>, <span class="ruby-identifier">manifest</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--lib&quot;</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--profile&quot;</span>, <span class="ruby-identifier">profile</span>.<span class="ruby-identifier">to_s</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--locked&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">profile</span> <span class="ruby-operator">==</span> <span class="ruby-value">:release</span>
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Command</span>.<span class="ruby-identifier">build_args</span>
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;--&quot;</span>]
  <span class="ruby-identifier">cmd</span> <span class="ruby-operator">+=</span> [<span class="ruby-operator">*</span><span class="ruby-identifier">cargo_rustc_args</span>(<span class="ruby-identifier">dest_path</span>)]
  <span class="ruby-identifier">cmd</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

      <div id="method-i-cargo_crate_name" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">cargo_crate_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="cargo_crate_name-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cargo_crate_name</span>
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">metadata</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;cargo_crate_name&quot;</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>).<span class="ruby-identifier">tr</span>(<span class="ruby-string">&quot;-&quot;</span>, <span class="ruby-string">&quot;_&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-cargo_dylib_path" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">cargo_dylib_path</span><span
            class="method-args">(dest_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="cargo_dylib_path-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cargo_dylib_path</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-identifier">prefix</span> = <span class="ruby-identifier">so_ext</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;dll&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;lib&quot;</span>
  <span class="ruby-identifier">path_parts</span> = [<span class="ruby-identifier">dest_path</span>]
  <span class="ruby-identifier">path_parts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;CARGO_BUILD_TARGET&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;CARGO_BUILD_TARGET&quot;</span>]
  <span class="ruby-identifier">path_parts</span> <span class="ruby-operator">+=</span> [<span class="ruby-identifier">profile_target_directory</span>, <span class="ruby-node">&quot;#{prefix}#{cargo_crate_name}.#{so_ext}&quot;</span>]
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">path_parts</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-cargo_rustc_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">cargo_rustc_args</span><span
            class="method-args">(dest_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="cargo_rustc_args-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cargo_rustc_args</span>(<span class="ruby-identifier">dest_dir</span>)
  [
    <span class="ruby-operator">*</span><span class="ruby-identifier">linker_args</span>,
    <span class="ruby-operator">*</span><span class="ruby-identifier">mkmf_libpath</span>,
    <span class="ruby-operator">*</span><span class="ruby-identifier">rustc_dynamic_linker_flags</span>(<span class="ruby-identifier">dest_dir</span>),
    <span class="ruby-operator">*</span><span class="ruby-identifier">rustc_lib_flags</span>(<span class="ruby-identifier">dest_dir</span>),
    <span class="ruby-operator">*</span><span class="ruby-identifier">platform_specific_rustc_args</span>(<span class="ruby-identifier">dest_dir</span>),
    <span class="ruby-operator">*</span><span class="ruby-identifier">debug_flags</span>,
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-darwin_target-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">darwin_target?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="darwin_target-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">darwin_target?</span>
  <span class="ruby-identifier">makefile_config</span>(<span class="ruby-string">&quot;target_os&quot;</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;darwin&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-debug_flags" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">debug_flags</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Good balance between binary size and debugability</p>

          <div class="method-source-code" id="debug_flags-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 258</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">debug_flags</span>
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">profile</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dev</span>

  [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-string">&quot;debuginfo=1&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-final_extension_path" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">final_extension_path</span><span
            class="method-args">(dest_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="final_extension_path-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">final_extension_path</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-identifier">dylib_path</span> = <span class="ruby-identifier">cargo_dylib_path</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-identifier">dlext_name</span> = <span class="ruby-node">&quot;#{spec.name}.#{makefile_config(&quot;DLEXT&quot;)}&quot;</span>
  <span class="ruby-identifier">dylib_path</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">dylib_path</span>), <span class="ruby-identifier">dlext_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-finalize_directory" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">finalize_directory</span><span
            class="method-args">(dest_path, lib_dir, extension_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Copied from ExtConfBuilder</p>

          <div class="method-source-code" id="finalize_directory-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">finalize_directory</span>(<span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">lib_dir</span>, <span class="ruby-identifier">extension_dir</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;fileutils&quot;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;tempfile&quot;</span>

  <span class="ruby-identifier">ext_path</span> = <span class="ruby-identifier">final_extension_path</span>(<span class="ruby-identifier">dest_path</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">tmp_dest</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mktmpdir</span>(<span class="ruby-string">&quot;.gem.&quot;</span>, <span class="ruby-identifier">extension_dir</span>)

    <span class="ruby-comment"># Some versions of `mktmpdir` return absolute paths, which will break make</span>
    <span class="ruby-comment"># if the paths contain spaces.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># As such, we convert to a relative path.</span>
    <span class="ruby-identifier">tmp_dest_relative</span> = <span class="ruby-identifier">get_relative_path</span>(<span class="ruby-identifier">tmp_dest</span>.<span class="ruby-identifier">clone</span>, <span class="ruby-identifier">extension_dir</span>)

    <span class="ruby-identifier">full_tmp_dest</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">extension_dir</span>, <span class="ruby-identifier">tmp_dest_relative</span>)

    <span class="ruby-comment"># TODO: remove in RubyGems 4</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">install_extension_in_lib</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lib_dir</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">lib_dir</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp_r</span> <span class="ruby-identifier">ext_path</span>, <span class="ruby-identifier">lib_dir</span>, <span class="ruby-value">remove_destination:</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-constant">FileUtils</span><span class="ruby-operator">::</span><span class="ruby-constant">Entry_</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">full_tmp_dest</span>).<span class="ruby-identifier">traverse</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ent</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">destent</span> = <span class="ruby-identifier">ent</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dest_path</span>, <span class="ruby-identifier">ent</span>.<span class="ruby-identifier">rel</span>)
      <span class="ruby-identifier">destent</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-operator">||</span> <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span>(<span class="ruby-identifier">ent</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">destent</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">tmp_dest</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tmp_dest</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-get_relative_path" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_relative_path</span><span
            class="method-args">(path, base)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="get_relative_path-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_relative_path</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">base</span>)
  <span class="ruby-identifier">path</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">base</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>] = <span class="ruby-string">&quot;.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-identifier">base</span>)
  <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ldflag_to_link_modifier" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ldflag_to_link_modifier</span><span
            class="method-args">(arg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ldflag_to_link_modifier-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ldflag_to_link_modifier</span>(<span class="ruby-identifier">arg</span>)
  <span class="ruby-constant">LinkFlagConverter</span>.<span class="ruby-identifier">convert</span>(<span class="ruby-identifier">arg</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-libruby_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">libruby_args</span><span
            class="method-args">(dest_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="libruby_args-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">libruby_args</span>(<span class="ruby-identifier">dest_dir</span>)
  <span class="ruby-identifier">libs</span> = <span class="ruby-identifier">makefile_config</span>(<span class="ruby-identifier">ruby_static?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;LIBRUBYARG_STATIC&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;LIBRUBYARG_SHARED&quot;</span>)
  <span class="ruby-identifier">raw_libs</span> = <span class="ruby-constant">Shellwords</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">libs</span>)
  <span class="ruby-identifier">raw_libs</span>.<span class="ruby-identifier">flat_map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ldflag_to_link_modifier</span>(<span class="ruby-identifier">l</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-linker_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">linker_args</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>We want to use the same linker that Ruby uses, so that the linker flags from mkmf work properly.</p>

          <div class="method-source-code" id="linker_args-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">linker_args</span>
  <span class="ruby-comment"># Have to handle CC=&quot;cl /nologo&quot; on mswin</span>
  <span class="ruby-identifier">cc_flag</span> = <span class="ruby-constant">Shellwords</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">makefile_config</span>(<span class="ruby-string">&quot;CC&quot;</span>))
  <span class="ruby-identifier">linker</span> = <span class="ruby-identifier">cc_flag</span>.<span class="ruby-identifier">shift</span>
  <span class="ruby-identifier">link_args</span> = <span class="ruby-identifier">cc_flag</span>.<span class="ruby-identifier">flat_map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-node">&quot;link-arg=#{a}&quot;</span>] }

  [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-node">&quot;linker=#{linker}&quot;</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">link_args</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-makefile_config" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">makefile_config</span><span
            class="method-args">(var_name)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="makefile_config-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 249</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">makefile_config</span>(<span class="ruby-identifier">var_name</span>)
  <span class="ruby-identifier">val</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">MAKEFILE_CONFIG</span>[<span class="ruby-identifier">var_name</span>]

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">val</span>

  <span class="ruby-constant">RbConfig</span>.<span class="ruby-identifier">expand</span>(<span class="ruby-identifier">val</span>.<span class="ruby-identifier">dup</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-maybe_resolve_ldflag_variable" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">maybe_resolve_ldflag_variable</span><span
            class="method-args">(input_arg, dest_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Interpolate substition vars in the arg (i.e. $(DEFFILE))</p>

          <div class="method-source-code" id="maybe_resolve_ldflag_variable-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">maybe_resolve_ldflag_variable</span>(<span class="ruby-identifier">input_arg</span>, <span class="ruby-identifier">dest_dir</span>)
  <span class="ruby-identifier">var_matches</span> = <span class="ruby-identifier">input_arg</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/\$\((\w+)\)/</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">input_arg</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">var_matches</span>

  <span class="ruby-identifier">var_name</span> = <span class="ruby-identifier">var_matches</span>[<span class="ruby-value">1</span>]

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">input_arg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">var_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">var_name</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">var_name</span>
  <span class="ruby-comment"># On windows, it is assumed that mkmf has setup an exports file for the</span>
  <span class="ruby-comment"># extension, so we have to to create one ourselves.</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;DEFFILE&quot;</span>
    <span class="ruby-identifier">write_deffile</span>(<span class="ruby-identifier">dest_dir</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-identifier">var_name</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-mingw_target-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">mingw_target?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="mingw_target-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mingw_target?</span>
  <span class="ruby-identifier">makefile_config</span>(<span class="ruby-string">&quot;target_os&quot;</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;mingw&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-mkmf_libpath" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">mkmf_libpath</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Corresponds to $(LIBPATH) in mkmf</p>

          <div class="method-source-code" id="mkmf_libpath-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mkmf_libpath</span>
  [<span class="ruby-string">&quot;-L&quot;</span>, <span class="ruby-node">&quot;native=#{makefile_config(&quot;libdir&quot;)}&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-msvc_target-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">msvc_target?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="msvc_target-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">msvc_target?</span>
  <span class="ruby-identifier">makefile_config</span>(<span class="ruby-string">&quot;target_os&quot;</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;msvc&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-platform_specific_rustc_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">platform_specific_rustc_args</span><span
            class="method-args">(dest_dir, flags = [])</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="platform_specific_rustc_args-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">platform_specific_rustc_args</span>(<span class="ruby-identifier">dest_dir</span>, <span class="ruby-identifier">flags</span> = [])
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">mingw_target?</span>
    <span class="ruby-comment"># On mingw platforms, mkmf adds libruby to the linker flags</span>
    <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">libruby_args</span>(<span class="ruby-identifier">dest_dir</span>)

    <span class="ruby-comment"># Make sure ALSR is used on mingw</span>
    <span class="ruby-comment"># see https://github.com/rust-lang/rust/pull/75406/files</span>
    <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-string">&quot;link-arg=-Wl,--dynamicbase&quot;</span>]
    <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-string">&quot;link-arg=-Wl,--disable-auto-image-base&quot;</span>]

    <span class="ruby-comment"># If the gem is installed on a host with build tools installed, but is</span>
    <span class="ruby-comment"># run on one that isn&#39;t the missing libraries will cause the extension</span>
    <span class="ruby-comment"># to fail on start.</span>
    <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-string">&quot;link-arg=-static-libgcc&quot;</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">darwin_target?</span>
    <span class="ruby-comment"># Ventura does not always have this flag enabled</span>
    <span class="ruby-identifier">flags</span> <span class="ruby-operator">+=</span> [<span class="ruby-string">&quot;-C&quot;</span>, <span class="ruby-string">&quot;link-arg=-Wl,-undefined,dynamic_lookup&quot;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">flags</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-profile_target_directory" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">profile_target_directory</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="profile_target_directory-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">profile_target_directory</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">profile</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:release</span> <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;release&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dev</span>     <span class="ruby-keyword">then</span> <span class="ruby-string">&quot;debug&quot;</span>
  <span class="ruby-keyword">else</span>          <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown target directory for profile: #{profile}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-rb_config_env" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">rb_config_env</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="rb_config_env-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rb_config_env</span>
  <span class="ruby-identifier">result</span> = {}
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">result</span>[<span class="ruby-node">&quot;RBCONFIG_#{k}&quot;</span>] = <span class="ruby-identifier">v</span> }
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-rename_cdylib_for_ruby_compatibility" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">rename_cdylib_for_ruby_compatibility</span><span
            class="method-args">(dest_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Ruby expects the dylib to follow a file name convention for loading</p>

          <div class="method-source-code" id="rename_cdylib_for_ruby_compatibility-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rename_cdylib_for_ruby_compatibility</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-identifier">new_path</span> = <span class="ruby-identifier">final_extension_path</span>(<span class="ruby-identifier">dest_path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">cargo_dylib_path</span>(<span class="ruby-identifier">dest_path</span>), <span class="ruby-identifier">new_path</span>)
  <span class="ruby-identifier">new_path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ruby_static-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ruby_static?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ruby_static-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ruby_static?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-node">%w[1 true]</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;RUBY_STATIC&quot;</span>])

  <span class="ruby-identifier">makefile_config</span>(<span class="ruby-string">&quot;ENABLE_SHARED&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&quot;no&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-rustc_dynamic_linker_flags" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">rustc_dynamic_linker_flags</span><span
            class="method-args">(dest_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="rustc_dynamic_linker_flags-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rustc_dynamic_linker_flags</span>(<span class="ruby-identifier">dest_dir</span>)
  <span class="ruby-identifier">split_flags</span>(<span class="ruby-string">&quot;DLDFLAGS&quot;</span>)
    .<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">maybe_resolve_ldflag_variable</span>(<span class="ruby-identifier">arg</span>, <span class="ruby-identifier">dest_dir</span>) }
    .<span class="ruby-identifier">compact</span>
    .<span class="ruby-identifier">flat_map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ldflag_to_link_modifier</span>(<span class="ruby-identifier">arg</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-rustc_lib_flags" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">rustc_lib_flags</span><span
            class="method-args">(dest_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="rustc_lib_flags-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rustc_lib_flags</span>(<span class="ruby-identifier">dest_dir</span>)
  <span class="ruby-identifier">split_flags</span>(<span class="ruby-string">&quot;LIBS&quot;</span>).<span class="ruby-identifier">flat_map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ldflag_to_link_modifier</span>(<span class="ruby-identifier">arg</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-so_ext" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">so_ext</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>We have to basically reimplement <a href="'SOEXT'">RbConfig::CONFIG</a> here to support Ruby &lt; 2.5</p>

<p>@see <a href="https://github.com/ruby/ruby/blob/c87c027f18c005460746a74c07cd80ee355b16e4/configure.ac#L3185">github.com/ruby/ruby/blob/c87c027f18c005460746a74c07cd80ee355b16e4/configure.ac#L3185</a></p>

          <div class="method-source-code" id="so_ext-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">so_ext</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;SOEXT&quot;</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&quot;SOEXT&quot;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">win_target?</span>
    <span class="ruby-string">&quot;dll&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">darwin_target?</span>
    <span class="ruby-string">&quot;dylib&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&quot;so&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-split_flags" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">split_flags</span><span
            class="method-args">(var)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="split_flags-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">split_flags</span>(<span class="ruby-identifier">var</span>)
  <span class="ruby-constant">Shellwords</span>.<span class="ruby-identifier">split</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">var</span>, <span class="ruby-string">&quot;&quot;</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-validate_cargo_build-21" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">validate_cargo_build!</span><span
            class="method-args">(dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="validate_cargo_build-21-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate_cargo_build!</span>(<span class="ruby-identifier">dir</span>)
  <span class="ruby-identifier">dylib_path</span> = <span class="ruby-identifier">cargo_dylib_path</span>(<span class="ruby-identifier">dir</span>)

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">DylibNotFoundError</span>, <span class="ruby-identifier">dir</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">dylib_path</span>)

  <span class="ruby-identifier">dylib_path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-win_target-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">win_target?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="win_target-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">win_target?</span>
  <span class="ruby-identifier">target_platform</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;target_os&quot;</span>]
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">WIN_PATTERNS</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">target_platform</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">r</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-write_deffile" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">write_deffile</span><span
            class="method-args">(dest_dir)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="write_deffile-source">
            <pre><span class="ruby-comment"># File lib/rubygems/ext/cargo_builder.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">write_deffile</span>(<span class="ruby-identifier">dest_dir</span>)
  <span class="ruby-identifier">deffile_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dest_dir</span>, <span class="ruby-node">&quot;#{spec.name}-#{RbConfig::CONFIG[&quot;arch&quot;]}.def&quot;</span>)
  <span class="ruby-identifier">export_prefix</span> = <span class="ruby-identifier">makefile_config</span>(<span class="ruby-string">&quot;EXPORT_PREFIX&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">deffile_path</span>, <span class="ruby-string">&quot;w&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;EXPORTS&quot;</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{export_prefix.strip}Init_#{spec.name}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">deffile_path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

